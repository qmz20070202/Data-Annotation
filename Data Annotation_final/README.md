# 手写汉字 OCR 标注工具

一个纯客户端的网页应用，让数据标注员能够高效地对图片中的手写文字进行识别、校准和标注，为内部 OCR 模型的训练提供高质量数据。

## 项目特色

- **零配置启动** - 直接在浏览器中打开 `index.html` 即可使用
- **纯客户端运行** - 无需服务器环境，数据完全本地处理
- **苹果级设计** - 遵循苹果设计哲学，界面简洁美观
- **高效标注** - 支持批量OCR识别和手动标注校正
- **实时预览** - 左侧图片实时显示标注框，右侧文本即时编辑

## 技术栈

- **HTML5** - 应用结构和骨架
- **CSS3** - 苹果风格界面美化  
- **JavaScript (ES6+)** - 所有核心逻辑实现
- **File System Access API** - 本地文件夹访问
- **Canvas API** - 图片标注框绘制
- **Fetch API** - OCR服务调用

## 快速开始

### 1. 下载项目
```bash
git clone <repository-url>
# 或直接下载ZIP文件并解压
```

### 2. 打开应用
使用现代浏览器（推荐 Chrome 或 Edge 最新版）直接打开 `index.html` 文件

### 3. 开始标注
1. 点击"选择文件夹"按钮，选择包含图片的文件夹
2. 点击"识别文字"进行批量OCR处理
3. 在左侧图片上手动绘制新的标注框（如需要）
4. 在右侧文本框中编辑识别结果
5. 点击"保存标注"导出JSON格式的标注数据

## 功能详解

### 🗂️ 文件管理
- **智能扫描** - 自动识别文件夹中的图片文件（支持 jpg, png, gif, bmp）
- **批量处理** - 一次性处理整个文件夹的所有图片
- **文件导航** - 便捷的文件列表和图片切换功能

### 🎯 OCR识别  
- **API集成** - 支持百度OCR API调用
- **模拟模式** - 提供测试模式，无需配置API即可体验
- **批量识别** - 自动处理所有图片并显示进度
- **结果缓存** - 识别结果自动保存，切换图片时快速加载

### ✏️ 标注编辑
- **可视化标注** - 在图片上直接绘制标注框
- **实时联动** - 标注框与文本编辑框实时高亮对应
- **手动校正** - 支持手动添加、删除、修改标注
- **精确定位** - 标注框坐标精确到像素级别

### 💾 数据导出
- **JSON格式** - 标准化的数据结构，便于后续处理
- **完整信息** - 包含文字内容、坐标位置、标注来源等
- **一键下载** - 自动生成下载文件，无需额外操作

## 项目结构

```
ocr-annotation-tool/
├── index.html              # 应用入口文件
├── README.md              # 项目说明文档
├── CLAUDE.md              # 开发规范和指导原则
├── css/
│   └── style.css          # 苹果风格样式表
├── js/
│   ├── main.js            # 主控制器，负责应用初始化和状态管理
│   ├── ui.js              # UI管理器，负责所有DOM操作
│   ├── canvas.js          # Canvas管理器，负责图片显示和标注绘制
│   └── api.js             # API管理器，负责OCR服务调用
└── assets/
    └── icons/             # SVG图标资源
```

## 使用指南

### 基础操作

#### 1. 选择图片文件夹
- 点击工具栏中的"选择文件夹"按钮
- 在弹出的文件夹选择对话框中选择包含图片的文件夹
- 系统会自动扫描并显示所有支持的图片文件

#### 2. 执行OCR识别
- 在加载图片后，点击"识别文字"按钮
- 系统会批量处理所有图片，显示识别进度
- 识别完成后，标注框会自动显示在图片上，文本显示在右侧

#### 3. 手动标注
- 在左侧图片区域按住鼠标左键拖拽绘制新的标注框
- 释放鼠标后，右侧会自动添加对应的文本编辑框
- 在文本框中输入正确的文字内容

#### 4. 编辑和校正
- 直接在右侧文本框中修改OCR识别的错误文字
- 点击文本框旁的删除按钮可删除不需要的标注
- 鼠标悬浮在文本框或标注框上会高亮显示对应项

#### 5. 保存数据
- 完成标注后，点击"保存标注"按钮
- 系统会自动生成JSON文件并下载到本地
- JSON文件包含所有图片的标注信息

### 快捷键

- `←` / `→` - 切换上一张/下一张图片
- `Ctrl + S` - 保存标注数据
- `Ctrl + N` - 添加新的文本框

### 数据格式

导出的JSON文件结构如下：

```json
{
  "version": "1.0",
  "createdAt": "2024-01-15T10:30:00.000Z",
  "folderName": "handwriting_samples",
  "totalImages": 10,
  "annotations": {
    "image1.jpg": {
      "imageInfo": {
        "name": "image1.jpg",
        "annotationCount": 3
      },
      "textRegions": [
        {
          "id": 1642234567890,
          "text": "手写汉字",
          "region": {
            "left": 50,
            "top": 50,
            "width": 120,
            "height": 30
          },
          "isManual": false
        }
      ]
    }
  }
}
```

## OCR API 配置

### 使用百度OCR API

1. **获取API密钥**
   - 注册百度云账号：https://cloud.baidu.com/
   - 创建手写文字识别应用
   - 获取API Key和Secret Key

2. **获取Access Token**
   ```bash
   curl -i -k 'https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=[API_KEY]&client_secret=[SECRET_KEY]'
   ```

3. **配置API**
   - 打开 `js/api.js` 文件
   - 找到 `this.config` 对象
   - 将 `mockMode` 设置为 `false`
   - 填入获取到的 `accessToken`

### 使用模拟模式（推荐用于测试）

- `mockMode` 保持为 `true`（默认设置）
- 无需任何API配置
- 会生成模拟的OCR识别结果用于测试

## 浏览器兼容性

- ✅ Chrome 86+
- ✅ Edge 86+
- ✅ Firefox 82+
- ⚠️ Safari 14+ （部分功能受限）

**注意**：本应用使用了 File System Access API，在某些浏览器中可能需要开启实验性功能。

## 故障排除

### 常见问题

**Q: 选择文件夹时提示不支持**
A: 请使用最新版本的Chrome或Edge浏览器，并确保启用了File System Access API。

**Q: OCR识别失败**
A: 
- 检查网络连接
- 确认API配置是否正确
- 验证Access Token是否有效
- 可以先使用模拟模式测试

**Q: 标注框位置不准确**
A: 这通常是图片缩放导致的坐标系问题，请尝试刷新页面重新加载图片。

**Q: 无法保存数据**
A: 检查浏览器是否允许下载文件，某些浏览器可能会阻止自动下载。

### 调试方法

1. **打开浏览器开发者工具** (F12)
2. **查看控制台输出** - 错误信息会显示在Console标签页
3. **检查网络请求** - Network标签页可以查看API调用情况
4. **验证数据结构** - 在Console中输入 `window.ocrTool.getState()` 查看应用状态

## 性能优化建议

### 处理大量图片时
- 建议单次处理不超过50张图片
- 如有大量图片，可分批处理
- 关闭其他不必要的浏览器标签页

### 处理大尺寸图片时
- 图片会自动缩放以适应界面
- 标注坐标会按比例转换，确保准确性
- 建议预处理图片尺寸以获得最佳性能

## 下一步功能规划

### 效率提升
- [ ] 添加更多快捷键支持
- [ ] 实现批量文本操作
- [ ] 支持标注模板预设

### 数据管理
- [ ] 支持项目文件保存和加载
- [ ] 实现标注进度跟踪
- [ ] 添加数据验证和质量检查

### 用户体验
- [ ] 支持多语言界面
- [ ] 添加操作历史和撤销功能
- [ ] 实现标注统计和分析

## 贡献指南

欢迎提交Issues和Pull Requests来改进这个项目！

### 开发环境搭建
1. 克隆项目到本地
2. 使用现代浏览器打开 `index.html` 
3. 开始开发和测试

### 代码规范
- 遵循项目既有的代码风格
- 添加必要的注释说明
- 确保新功能有对应的错误处理

## 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 GitHub Issue
- 发送邮件至：[your-email@example.com]

---

**享受高效的OCR标注体验！** 🚀